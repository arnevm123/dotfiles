#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
    selected=$1
else
	selected=$( (echo "home" && find ~/Projects ~/Documents ~/Tools -mindepth 1 -maxdepth 1 -type d && echo "create") | sed 's#^\(/[^/]*\)\{2\}/##' | fzf)
fi

if [[ -z $selected ]]; then
    exit 0
fi

selected="$HOME/$selected"
selected_name=$(basename "$selected" | tr . _)

case $selected_name in
  moaprfrontend)
    selected+="/moapr"
    ;;

  moaprWorktree)
    selected+="/master"
    ;;
esac

if [[ "$selected_name" == "create" ]]; then
	echo "Please enter the new folder name:"
	read -r selected_name
	selected="$HOME/Documents/$selected_name"
	mkdir "$selected"
fi

if [[ "$selected_name" == "home" ]]; then
	selected="$HOME"
fi

existingSession=$(tmux list-sessions -F '#S' | grep "^$selected_name$")

if [[ -z $TMUX ]]; then
    # not in tmux session
    if [[ -z $existingSession ]]; then
        # session does not exist
        tmux new-session -s "$selected_name" -c "$selected"
    else
        # session exists... attach to it
        tmux attach -t "$selected_name"
    fi
else
    # inside tmux session
    if [[ -z $existingSession ]]; then
        # session does not exist... create it
        tmux new-session -d -s "$selected_name" -c "$selected"
    fi
        # switch to the session
        tmux switch-client -t "$selected_name"
fi
