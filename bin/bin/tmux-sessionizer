#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
    selected=$1
else
	selected=$( (find ~/Documents ~/Tools -mindepth 1 -maxdepth 1 -type d && echo "create") | fzf)
fi

if [[ -z $selected ]]; then
    exit 0
fi

selected_name=$(basename "$selected" | tr . _)

case $selected_name in
  moaprfrontend)
    selected+="/moapr"
    ;;

  moaprWorktree)
    selected+="/master"
    ;;
esac

# if [[ "$selected_name" == "moaprReview" ]]; then
# 	selected_name="REVIEW_"
#     selected=$(find ~/Documents/moaprReview -mindepth 1 -maxdepth 1 -type d | fzf)
# 	sn=$(basename "$selected" | tr . _)
# 	selected_name+=$sn
# fi
if [[ "$selected_name" == "create" ]]; then
	echo "Please enter the new folder name:"
	read -r selected_name
	selected="$HOME/Documents/$selected_name"
	mkdir "$selected"
fi

# if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
#     tmux new-session -s "$selected_name" -c "$selected"
#     exit 0
# fi
#
# if ! tmux has-session -t="$selected_name" 2> /dev/null; then
#     tmux new-session -ds "$selected_name" -c "$selected"
# fi
#
# tmux switch-client -t "$selected_name"
# check if a session with the same name already exists

existingSession=$(tmux list-sessions -F '#S' | grep "^$selected_name$")

if [[ -z $TMUX ]]; then
    # not in tmux session
    if [[ -z $existingSession ]]; then
        # session does not exist
        tmux new-session -s "$selected_name" -c "$selected"
    else
        # session exists... attach to it
        tmux attach -t "$selected_name"
    fi
else
    # inside tmux session
    if [[ -z $existingSession ]]; then
        # session does not exist... create it
        tmux new-session -d -s "$selected_name" -c "$selected"
    fi
        # switch to the session
        tmux switch-client -t "$selected_name"
fi
